From 201294e0edc5df086e65a07e57ea72fa951eda86 Mon Sep 17 00:00:00 2001
From: Laur59 <148864407+Laur59@users.noreply.github.com>
Date: Sun, 23 Mar 2025 08:18:03 +0100
Subject: [PATCH 1/3] Apply settings suited for buildin uKOS projects

---
 arm-software/embedded/CMakeLists.txt          |   7 +-
 .../embedded/arm-multilib/json/multilib.json  | 120 ------------------
 .../arm-multilib/multilib-generate.py         |   2 +-
 3 files changed, 5 insertions(+), 124 deletions(-)

diff --git a/arm-software/embedded/CMakeLists.txt b/arm-software/embedded/CMakeLists.txt
index bca8bd33f114..ab0363481726 100644
--- a/arm-software/embedded/CMakeLists.txt
+++ b/arm-software/embedded/CMakeLists.txt
@@ -151,7 +151,7 @@ set(PARALLEL_LIB_BUILD_LEVELS
 option(
     ENABLE_QEMU_TESTING
     "Enable tests that use QEMU. This option is ON by default."
-    ON
+    OFF
 )
 option(
     ENABLE_FVP_TESTING
@@ -221,6 +221,7 @@ set(LLVM_DISTRIBUTION_COMPONENTS
     llvm-strings
     llvm-strip
     llvm-symbolizer
+    scan-build
     LTO
     CACHE STRING ""
 )
@@ -234,8 +235,8 @@ set(LLVM_TOOLCHAIN_DISTRIBUTION_COMPONENTS
 installed by the install-llvm-toolchain target"
 )
 set(LLVM_ENABLE_PROJECTS clang;lld CACHE STRING "")
-set(LLVM_TARGETS_TO_BUILD AArch64;ARM CACHE STRING "")
-set(LLVM_DEFAULT_TARGET_TRIPLE aarch64-linux-gnu CACHE STRING "")
+set(LLVM_TARGETS_TO_BUILD ARM CACHE STRING "")
+set(LLVM_DEFAULT_TARGET_TRIPLE arm-none-eabi CACHE STRING "")
 set(LLVM_APPEND_VC_REV OFF CACHE BOOL "")
 set(LLVM_ENABLE_TERMINFO OFF CACHE BOOL "")
 set(LLVM_ENABLE_ZLIB OFF CACHE BOOL "")
diff --git a/arm-software/embedded/arm-multilib/json/multilib.json b/arm-software/embedded/arm-multilib/json/multilib.json
index 20d860c97f0e..726b53260617 100644
--- a/arm-software/embedded/arm-multilib/json/multilib.json
+++ b/arm-software/embedded/arm-multilib/json/multilib.json
@@ -1,125 +1,5 @@
 {
     "libs": [
-        {
-            "variant": "aarch64a_exn_rtti_unaligned",
-            "json": "aarch64a_exn_rtti_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf"
-        },
-        {
-            "variant": "aarch64a_unaligned",
-            "json": "aarch64a_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf -fno-exceptions -fno-rtti"
-        },
-        { 
-            "variant": "aarch64a_be_exn_rtti",
-            "json": "aarch64a_be_exn_rtti.json",
-            "flags": "--target=aarch64_be-unknown-none-elf"
-        },
-        {
-            "variant": "aarch64a_be",
-            "json": "aarch64a_be.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -fno-exceptions -fno-rtti"
-        },
-        {
-            "variant": "aarch64a_exn_rtti",
-            "json": "aarch64a_exn_rtti.json",
-            "flags": "--target=aarch64-unknown-none-elf -mno-unaligned-access"
-        },
-        {
-            "variant": "aarch64a",
-            "json": "aarch64a.json",
-            "flags": "--target=aarch64-unknown-none-elf -mno-unaligned-access -fno-exceptions -fno-rtti"
-        },
-        {
-            "variant": "aarch64a_soft_nofp_exn_rtti",
-            "json": "aarch64a_soft_nofp_exn_rtti.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64a_soft_nofp",
-            "json": "aarch64a_soft_nofp.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft -fno-exceptions -fno-rtti",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64a_be_soft_nofp_exn_rtti",
-            "json": "aarch64a_be_soft_nofp_exn_rtti.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64a_be_soft_nofp",
-            "json": "aarch64a_be_soft_nofp.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft -fno-exceptions -fno-rtti",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_exn_rtti_unaligned",
-            "json": "aarch64r_exn_rtti_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r"
-        },
-        {
-            "variant": "aarch64r_unaligned",
-            "json": "aarch64r_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -fno-exceptions -fno-rtti"
-        },
-        {
-            "variant": "aarch64r_be_exn_rtti",
-            "json": "aarch64r_be_exn_rtti.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armv8-r"
-        },
-        {
-            "variant": "aarch64r_be",
-            "json": "aarch64r_be.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armv8-r -fno-exceptions -fno-rtti"
-        },
-        {
-            "variant": "aarch64r_exn_rtti",
-            "json": "aarch64r_exn_rtti.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -mno-unaligned-access"
-        },
-        {
-            "variant": "aarch64r",
-            "json": "aarch64r.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -fno-exceptions -fno-rtti -mno-unaligned-access"
-        },
-        {
-            "variant": "aarch64r_soft_nofp_exn_rtti_unaligned",
-            "json": "aarch64r_soft_nofp_exn_rtti_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_soft_nofp_unaligned",
-            "json": "aarch64r_soft_nofp_unaligned.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -fno-exceptions -fno-rtti -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_soft_nofp_exn_rtti",
-            "json": "aarch64r_soft_nofp_exn_rtti.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft -mno-unaligned-access",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_soft_nofp",
-            "json": "aarch64r_soft_nofp.json",
-            "flags": "--target=aarch64-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -fno-exceptions -fno-rtti -mabi=aapcs-soft -mno-unaligned-access",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_be_soft_nofp_exn_rtti",
-            "json": "aarch64r_be_soft_nofp_exn_rtti.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
-        {
-            "variant": "aarch64r_be_soft_nofp",
-            "json": "aarch64r_be_soft_nofp.json",
-            "flags": "--target=aarch64_be-unknown-none-elf -march=armv8-r -march=armvX+nofp -march=armvX+nosimd -fno-exceptions -fno-rtti -mabi=aapcs-soft",
-            "libraries_supported": "picolibc"
-        },
         {
             "variant": "armv4t_exn_rtti",
             "json": "armv4t_exn_rtti.json",
diff --git a/arm-software/embedded/arm-multilib/multilib-generate.py b/arm-software/embedded/arm-multilib/multilib-generate.py
index c7ea84c6e093..2761f3010ae9 100755
--- a/arm-software/embedded/arm-multilib/multilib-generate.py
+++ b/arm-software/embedded/arm-multilib/multilib-generate.py
@@ -236,7 +236,7 @@ def get_extension_list(clang, triple):
 
 
 def generate_extensions(args):
-    aarch64_features = get_extension_list(args.clang, "aarch64-none-eabi")
+    aarch64_features = get_extension_list(args.clang, "arm-none-eabi")
     aarch32_features = get_extension_list(args.clang, "arm-none-eabi")
     all_features = list(aarch64_features)
     # Combine the aarch64 and aarch32 lists without duplication.
-- 
2.39.5 (Apple Git-154)

