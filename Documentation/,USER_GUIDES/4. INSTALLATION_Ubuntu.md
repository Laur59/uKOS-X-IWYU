# Installation for Ubuntu machines

(c) 2025-20xx, Edo. Franzi, 2025-01-01

## Pre-requisite

On your machine the following tools have to be installed and configured:

**C++ compiler**,  **python3**, **git**

Minimal **git** configuration

```bash
git config --global user.email "ukos@ukos.ch"
git config --global user.name "uKOS"
```

On your HD you should have the full uKOS-X package **OS_Kernel-X**. For the tools, you should create a RW folder (**e.g. uKOS**) somewhere (a good practice is to create it in the **/opt** folder: **/opt/uKOS**).

```bash
# user = ukos and group = ukos
cd /opt
sudo mkdir -p uKOS
sudo chown -R user:group uKOS
sudo chmod -R o+rw uKOS
```

## the file .zshrc

Here is a working example that contains all he necessary paths and exports.

```bash
PROMPT='%n:%~%# '

# Set the PATH for the development environment
# --------------------------------------------

export PATH=/opt/uKOS/cross/cppcheck-current/bin:$PATH

PATH=${PATH}:/opt/local/bin:/opt/local/sbin
PATH=${PATH}:/usr/local/bin
PATH=${PATH}:/usr/bin
PATH=${PATH}:/usr/local/lib/pkgconfig

# Project environment
# -------------------
#
# PATH_UKOS_ROOT     = uKOS-X Project (active workspace)
# PATH_UKOS_X_PACKAGE   = uKOS-X kernel
# PATH_TOOLS_TSTROM  = uKOS-X scripts for building the test ROM

PATH_UKOS_ROOT=${HOME}/Your_Path_To_The_uKOS-X_Package
PATH_UKOS_X_PACKAGE=${PATH_UKOS_ROOT}/OS_Kernel-X
PATH_TOOLS_TSTROM=${PATH_UKOS_X_PACKAGE}/Applications/uKOS_TestRom

# Cross compilation environment
# -----------------------------
#
# PATH_TOOLS_ROOT     = Tool location
# PATH_TOOLS_GCC      = GCC root location
# PATH_TOOLS_UNIX     = uKOS-X BIN UNIX tool location

PATH_TOOLS_ROOT=/opt/uKOS
PATH_TOOLS_GCC=${PATH_TOOLS_ROOT}
PATH_TOOLS_UNIX=${PATH_TOOLS_ROOT}/local/bin

PATH_GCC_ARM=${PATH_TOOLS_GCC}/cross/gcc-current/arm
PATH_GCC_RVXX=${PATH_TOOLS_GCC}/cross/gcc-current/riscv
PATH_LLVM_ARM=${PATH_TOOLS_GCC}/cross/llvm-current/arm
PATH_LLVM_RVXX=${PATH_TOOLS_GCC}/cross/llvm-current/riscv
PATH_GCC_DFUUTIL=${PATH_TOOLS_GCC}/cross/dfu-util-current
PATH_PICOTOOL=${PATH_TOOLS_GCC}/cross/picotool-current

PATH=${PATH}:${PATH_TOOLS_UNIX}
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/cppcheck-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/doxygen-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/graphviz-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/cortex/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/stm/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/riscv32/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/riscv64/bin
PATH=${PATH}:${PATH_PICOTOOL}/bin

export PATH_TOOLS_ROOT
export PATH_TOOLS_GCC
export PATH_TOOLS_UNIX
export PATH_UKOS_X_PACKAGE
export PATH_GCC_ARM
export PATH_GCC_RVXX
export PATH_LLVM_ARM
export PATH_LLVM_RVXX
export PATH_GCC_DFUUTIL
export PATH_PICOTOOL
export PATH
```

## Add some packages and python tools

```bash
# Update the ready installed packages
sudo apt update && sudo apt upgrade -y

# Install the compilation tools
sudo apt install -y \
build-essential \
libtool libtool-bin \
bison flex gawk m4 texinfo automake \
libncurses-dev \
libusb-1.0-0-dev libusb-dev \
zlib1g-dev \
libpcre3 libpcre3-dev \
libgl1-mesa-dev \
libhidapi-dev \
intltool \
libgtk2.0-dev \
libudev-dev \
libjaylink-dev \
ninja-build \
meson \
clang \
cmake \
git \
gtkterm \
curl \
lzip \
zsh \
python3-pip \
python-is-python3 \
python3.13-venv

# Install additional fonts
sudo apt install -y ttf-mscorefonts-installer culmus

# Un-install/install yq
sudo apt remove -y yq || true
sudo snap install yq

# zsh by default
chsh -s /usr/bin/zsh || true

# Install venv-kflash
apt install python3.13-venv
python3 -m venv ~/uKOS_Soft/venv-uKOS
source ~/uKOS_Soft/venv-uKOS/bin/activate
pip install kflash
pip3 install PyYAML

# Disable BRLTTY
for f in /usr/lib/udev/rules.d/*brltty*.rules; do
    sudo ln -s /dev/null "/etc/udev/rules.d/$(basename "$f")"
done
sudo udevadm control --reload-rules
```

## Create some rules for using serial devices

On the desktop, create the file **90-ukos-ftdi.rules** (for **FTDI** chips) with this content:

```bash
ACTION!="add|change", GOTO="ukos_ftdi_rules_end"
SUBSYSTEM!="usb|tty", GOTO="ukos_ftdi_rules_end"
ATTRS{idProduct}=="6011", ATTRS{idVendor}=="0403", ATTRS{product}=="uKOS - Kernel",
GROUP="dialout"
ATTRS{idProduct}=="6011", ATTRS{idVendor}=="0403", ATTRS{product}=="uKOS - Kernel",
ENV{ID_USB_INTERFACE_NUM}=="00", RUN+="/bin/sh -c '/bin/echo $devpath | /usr/bin/cut
-d / -f 8 > /sys/bus/usb/drivers/ftdi_sio/unbind'"
ATTRS{idProduct}=="6015", ATTRS{idVendor}=="0403", ATTRS{product}=="uKOS - FIFO",
GROUP="dialout"
ATTRS{idProduct}=="6015", ATTRS{idVendor}=="0403", ATTRS{product}=="uKOS - FIFO",
ENV{ID_USB_INTERFACE_NUM}=="00", RUN+="/bin/sh -c '/bin/echo $devpath | /usr/bin/cut
-d / -f 8 > /sys/bus/usb/dri
```

Now, copy it in the rules.d folder

```bash
cd /etc/udev/rules.d
sudo cp ${HOME}/Desktop/90-ukos-ftdi.rules .
```

On the desktop, create the file **90-ukos-cp210x.rules** (for **Silicon Lab** chips) with this content:

```
SUBSYSTEMS=="usb", ATTRS{idVendor}=="10c4", ATTRS{idProduct}==“ea60", MODE=“0666"
```

Now, copy it in the rules.d folder

```bash
cd etc/udev/rules.d
sudo cp ${HOME}/Desktop/90-ukos-cp210x.rules .
```

On the desktop, create the file **40-ukos-dfuse.rules** (for **GD32DFU** chips) with this content:

```
ATTRS{idVendor}=="28e9", ATTRS{idProduct}=="0189", GROUP="plugdev", MODE="660"
```

Now, copy it in the rules.d folder

```bash
cd etc/udev/rules.d
sudo cp ${HOME}/Desktop/40-ukos-dfuse.rules .
```

## Now we can build all the necessary tools for working with uKOS-X

```bash
cd ${PATH_SCRIPTS}

# The following installation can take some time (> 1-hour)

# Build the gmp and mpfr library (needed by gdb):
./ukos_gmp.sh
./ukos_mpfr.sh

# Build the gcc ARM cortex and RISC-V toolchain:
./ukos_gnu_gcc_arm_eabi.sh
./ukos_gnu_gcc_riscv_elf.sh

# Build the llvm ARM cortex and RISC-V toolchain:
./ukos_clang_llvm_arm_eabi.sh
./ukos_clang_llvm_riscv_elf.sh

# Build the D2XX driver:
./ukos_D2XX.sh

# Build the libftdi, libusb, lib confuse & libjaylink:
./ukos_libForOpenocd.sh

# Build the openocd:
./ukos_openocd_cortex.sh
./ukos_openocd_stm.sh
./ukos_openocd_riscv.sh

# Build the doxygen and graphviz:
./ukos_doxygen.sh
./ukos_graphviz.sh

# Build the Cppcheck:
./ukos_cppcheck.sh

# Build the dfu_util:
./ukos_dfu-util.sh

# Build the picotool:
./ukos_picotool.sh
```
