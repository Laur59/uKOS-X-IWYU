# Installation for OSX machines

(c) 2025-20xx, Edo. Franzi, 2025-01-01

## Pre-requisite

Prepare your environment as described in document **README.md**.

On your machine the following tools have to be installed:

**Xcode** (do not forget to accept the Apple licence)

**xcode-select --install**,  [**Macport**](https://www.macports.org/)

On your HD you should have the full uKOS-X package **OS_Kernel-X**. For the tools, you should create a RW folder (**e.g. uKOS**) somewhere (a good practice is to create it in the **/opt** folder: **/opt/uKOS**).

```bash
cd /opt
sudo mkdir -p uKOS
sudo chgrp admin uKOS
sudo chmod g+w uKOS
```

## Add some Macport and Python tools

```bash
sudo port install automake
sudo port install libtool
sudo port install autoconf
sudo port install pkgconfig
sudo port install coreutils
sudo port install md5sha1sum
sudo port install ghostscript
sudo port install texinfo
sudo port install ctags
sudo port install wget
sudo port install hidapi
sudo port install py313-pip
sudo port install ninja
sudo port install meson
sudo port install bison
sudo port install pandoc
sudo port install gmake
sudo port install zlib
sudo port install yq
pip3 install kflash
pip3 install numpy
pip3 install pyserial
pip3 install matplotlib
pip3 install pillow
pip3 install PyYAML
```

## the file .zshrc

Here is a working example that contains all he necessary paths and exports.

```bash
PYTHON_REV=3.13
alias python3='/opt/local/Library/Frameworks/Python.framework/
               Versions/${PYTHON_REV}/bin/python${PYTHON_REV}'
alias pip3='/opt/local/Library/Frameworks/Python.framework/Versions/${PYTHON_REV}/bin/pip3'

alias githash='git describe --always --dirty --match='

# make
# Or we install gmake with macport and set a symbolic link
#    sudo ln -sf /opt/local/bin/gmake /usr/local/bin/make
# Or we use an alias
#    alias make='gmake'
#    PATH="/opt/local/libexec/gnubin:${PATH}"

# Set the PATH for the development environment
# --------------------------------------------

PATH="/Applications/CMake.app/Contents/bin":"${PATH}"
PATH="/opt/local/libexec/gnubin:${PATH}"
PATH=${PATH}:/opt/local/bin:/opt/local/sbin
PATH=${PATH}:/usr/local/bin
PATH=${PATH}:/usr/bin
PATH=${PATH}:/usr/local/lib/pkgconfig
PATH=${PATH}:/opt/local/Library/Frameworks/Python.framework/Versions/${PYTHON_REV}/bin
MANPATH=${MANPATH}:/opt/local/share/man

# Project environment
# -------------------
#
# PATH_PORTS_ROOT     = Macports tools
# PATH_UKOS_ROOT      = uKOS-X Project (active workspace)

PATH_PORTS_ROOT=/opt/local

# Cross compilation environment
# -----------------------------
#
# PATH_TOOLS_ROOT     = Tool location
# PATH_TOOLS_GCC      = GCC root location
# PATH_TOOLS_UNIX     = uKOS-X BIN UNIX tool location

PATH_TOOLS_ROOT=/opt/uKOS
PATH_TOOLS_GCC=${PATH_TOOLS_ROOT}
PATH_TOOLS_UNIX=${PATH_TOOLS_ROOT}/local/bin

PATH_GCC_ARM=${PATH_TOOLS_GCC}/cross/gcc-current/arm
PATH_GCC_RVXX=${PATH_TOOLS_GCC}/cross/gcc-current/riscv
PATH_LLVM_ARM=${PATH_TOOLS_GCC}/cross/llvm-current/arm
PATH_LLVM_RVXX=${PATH_TOOLS_GCC}/cross/llvm-current/riscv
PATH_GCC_DFUUTIL=${PATH_TOOLS_GCC}/cross/dfu-util-current
PATH_PICOTOOL=${PATH_TOOLS_GCC}/cross/picotool-current

PATH=${PATH}:${PATH_TOOLS_UNIX}
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/cppcheck-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/doxygen-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/graphviz-current/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/cortex/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/stm/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/riscv32/bin
PATH=${PATH}:${PATH_TOOLS_GCC}/cross/openocd-current/riscv64/bin
PATH=${PATH}:${PATH_GCC_DFUUTIL}/bin
PATH=${PATH}:${PATH_PICOTOOL}/bin
PATH=${PATH}:${HOME}/Library/Python/${PYTHON_REV}/bin

export PATH_TOOLS_ROOT
export PATH_TOOLS_GCC
export PATH_TOOLS_UNIX
export PATH_GCC_ARM
export PATH_GCC_RVXX
export PATH_LLVM_ARM
export PATH_LLVM_RVXX
export PATH_GCC_DFUUTIL
export PATH_PICOTOOL
export MANPATH
export PATH

export STM32_PRG_PATH=/Applications/STMicroelectronics/STM32Cube/ \
                      STM32CubeProgrammer/ STM32CubeProgrammer.app/Contents/MacOs/bin

```

## Now we can build all the necessary tools for working with uKOS-X

⚠ The following installation may take quite a while (more than an hour).  ⚠

Run the following commands from the installed directory `Tools/Scripts` (cd *`PATH_UKOS_X_PACKAGE`*/Tools/Scripts).

```bash
# Build the gmp and mpfr library (needed by gdb):
./ukos_gmp.sh
./ukos_mpfr.sh

# Build the gcc ARM cortex and RISC-V toolchain:
./ukos_gnu_gcc_arm_eabi.sh
./ukos_gnu_gcc_riscv_elf.sh

# Build the llvm ARM cortex and RISC-V toolchain:
./ukos_clang_llvm_arm_eabi.sh
./ukos_clang_llvm_riscv_elf.sh

# Build the D2XX driver:
./ukos_D2XX.sh

# Build the libftdi, libusb, lib confuse & libjaylink:
./ukos_libForOpenocd.sh

# Build the openocd:
./ukos_openocd_cortex.sh
./ukos_openocd_stm.sh
./ukos_openocd_riscv.sh

# Build the doxygen and graphviz:
./ukos_doxygen.sh
./ukos_graphviz.sh

# Build the Cppcheck:
./ukos_cppcheck.sh

# Build the dfu_util:
./ukos_dfu-util.sh
```
